<!DOCTYPE html>

<html lang="pt-BR">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Dashboard Gestor | Integrux Enterprise</title>

    <link rel="icon" type="image/png" href="https://i.imgur.com/EthgfYX.png">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">



    <style>

        :root {

            --bg-body: #050505;

            --bg-panel: #0E0F11;

            --bg-card: #141619;

            --border-color: #2D333B;

            --primary: #2F81F7;

            --primary-glow: rgba(47, 129, 247, 0.4);

            --success: #238636;

            --warning: #D29922;

            --danger: #F85149;

            --text-main: #E6EDF3;

            --text-muted: #7D8590;

        }



        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }



        body {

            background-color: var(--bg-body); color: var(--text-main);

            display: flex; min-height: 100vh; overflow-x: hidden; position: relative;

        }



        aside {

            width: 280px; background-color: var(--bg-panel); border-right: 1px solid var(--border-color);

            display: flex; flex-direction: column; padding: 30px 20px;

            position: fixed; height: 100vh; z-index: 100; transition: transform 0.3s ease;

        }



        .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 90; display: none; }

        .mobile-toggle { display: none; position: fixed; top: 20px; left: 20px; z-index: 110; background: var(--bg-card); border: 1px solid var(--border-color); padding: 8px; border-radius: 8px; cursor: pointer; color: white; }



        .brand { display: flex; align-items: center; gap: 12px; margin-bottom: 50px; padding-left: 5px; cursor: pointer; }

        .brand svg { width: 32px; height: 32px; fill: #FFF; filter: drop-shadow(0 0 10px var(--primary-glow)); }

        .brand-text { font-size: 1.3rem; font-weight: 700; letter-spacing: 1px; color: #FFF; }



        .nav-menu { flex: 1; display: flex; flex-direction: column; gap: 8px; }

        .nav-item {

            padding: 14px 18px; border-radius: 12px; color: var(--text-muted);

            cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 12px; font-weight: 500; font-size: 0.95rem;

            position: relative;

        }

        .nav-item svg { width: 20px; height: 20px; stroke-width: 2; }

        .nav-item:hover { background: rgba(255, 255, 255, 0.05); color: #FFF; }

        .nav-item.active { background: rgba(47, 129, 247, 0.1); color: var(--primary); border: 1px solid rgba(47, 129, 247, 0.2); }



        .sidebar-badge {

            background-color: var(--danger); color: white; font-size: 0.7rem; font-weight: bold;

            padding: 2px 6px; border-radius: 10px; margin-left: auto;

            box-shadow: 0 0 10px rgba(248, 81, 73, 0.4); animation: pulse-red 2s infinite;

        }

        .sidebar-badge.hidden { display: none; }



        .btn-logout { margin-top: auto; color: var(--danger); text-decoration: none; padding: 14px 18px; border-radius: 10px; transition: 0.2s; display: flex; align-items: center; gap: 10px; font-weight: 600; cursor: pointer; }

        .btn-logout:hover { background: rgba(248, 81, 73, 0.1); }



        main { margin-left: 280px; flex: 1; padding: 40px 50px; background-image: radial-gradient(circle at 80% 0%, #10151f 0%, transparent 40%); width: 100%; }



        header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 40px; flex-wrap: wrap; gap: 20px; }

        .header-text-container { margin-left: 0; transition: 0.3s; }

        h1 { font-size: 2rem; margin-bottom: 5px; font-weight: 700; letter-spacing: -0.5px; }

        .subtitle { color: var(--text-muted); font-size: 1rem; }



        .header-actions { display: flex; align-items: center; gap: 20px; margin-left: auto; }



        .notification-wrapper { position: relative; cursor: pointer; }

        .btn-bell { width: 45px; height: 45px; border-radius: 50%; background: var(--bg-card); border: 1px solid var(--border-color); display: flex; align-items: center; justify-content: center; color: var(--text-muted); transition: 0.2s; }

        .btn-bell:hover { color: #FFF; border-color: var(--primary); box-shadow: 0 0 15px rgba(47, 129, 247, 0.2); }

        .badge-count {

            position: absolute; top: -2px; right: -2px; background: var(--danger); color: white;

            font-size: 0.7rem; font-weight: bold; width: 18px; height: 18px; border-radius: 50%;

            display: flex; align-items: center; justify-content: center; border: 2px solid var(--bg-body);

            animation: pulse-red 2s infinite;

        }

        .badge-count.hidden { display: none; }

        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(248, 81, 73, 0.4); } 70% { box-shadow: 0 0 0 5px rgba(248, 81, 73, 0); } 100% { box-shadow: 0 0 0 0 rgba(248, 81, 73, 0); } }



        .user-badge { display: flex; align-items: center; gap: 15px; background: var(--bg-card); padding: 8px 12px 8px 20px; border-radius: 50px; border: 1px solid var(--border-color); cursor: default; transition: 0.2s; }

        .user-badge:hover { border-color: var(--primary); }

        .avatar { width: 40px; height: 40px; background: linear-gradient(135deg, var(--primary), #005CC5); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.1rem; box-shadow: 0 0 15px rgba(47, 129, 247, 0.4); text-transform: uppercase; }



        .view-section { display: none; animation: fadeIn 0.4s ease; }

        .view-section.active-view { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }



        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 40px; }

        .card { background: var(--bg-card); border: 1px solid var(--border-color); padding: 25px; border-radius: 16px; position: relative; overflow: hidden; transition: transform 0.3s, border-color 0.3s; }

        .card:hover { transform: translateY(-5px); border-color: var(--primary); box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5); }

        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }

        .card-icon-bg { width: 45px; height: 45px; border-radius: 10px; background: rgba(255,255,255,0.03); display: flex; align-items: center; justify-content: center; }

        .card-val { font-size: 2.2rem; font-weight: 700; font-family: 'JetBrains Mono', monospace; color: #FFF; }

        .card-label { color: var(--text-muted); font-size: 0.9rem; font-weight: 500; }

        .os-list { margin-top: 15px; display: flex; flex-direction: column; gap: 8px; }

        .os-item { display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--text-muted); border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 4px; }

        .os-item span:last-child { color: var(--text-main); font-family: 'JetBrains Mono', monospace; }



        .table-container { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 30px; overflow-x: auto; }

        .table-header { display: flex; justify-content: space-between; margin-bottom: 25px; align-items: center; min-width: 600px; }

        .table-header h3 { font-size: 1.2rem; display: flex; align-items: center; gap: 10px; }

        .chip { background: rgba(47, 129, 247, 0.1); color: var(--primary); padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; }

        table { width: 100%; border-collapse: separate; border-spacing: 0 8px; min-width: 700px; }

        th { text-align: left; color: var(--text-muted); font-size: 0.8rem; padding: 0 20px 15px 20px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }

        tr.data-row { background: rgba(255,255,255,0.02); transition: 0.2s; cursor: pointer; }

        tr.data-row:hover { background: rgba(255,255,255,0.05); transform: scale(1.005); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

        td { padding: 20px; font-size: 0.95rem; border-top: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color); vertical-align: middle; }

        td:first-child { border-left: 1px solid var(--border-color); border-radius: 12px 0 0 12px; font-weight: 600; color: #FFF; }

        td:last-child { border-right: 1px solid var(--border-color); border-radius: 0 12px 12px 0; }

        .mono-font { font-family: 'JetBrains Mono', monospace; color: var(--text-muted); font-size: 0.85rem; }



        .os-action-bar { display: flex; gap: 10px; justify-content: flex-end; }

        .timer-badge { font-family: 'JetBrains Mono'; font-size: 0.8rem; color: var(--warning); display: flex; align-items: center; gap: 5px; }

        .os-status-pill { padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; text-transform: uppercase; font-weight: 700; }

        .os-status-pending { background: rgba(210, 153, 34, 0.1); color: #D29922; border: 1px solid rgba(210, 153, 34, 0.3); }

        .os-status-exec { background: rgba(47, 129, 247, 0.1); color: #2F81F7; border: 1px solid rgba(47, 129, 247, 0.3); animation: pulse-blue 2s infinite; }

        .os-status-done { background: rgba(35, 134, 54, 0.1); color: #238636; border: 1px solid rgba(35, 134, 54, 0.3); }

        @keyframes pulse-blue { 0% { box-shadow: 0 0 0 0 rgba(47, 129, 247, 0.4); } 70% { box-shadow: 0 0 0 5px rgba(47, 129, 247, 0); } 100% { box-shadow: 0 0 0 0 rgba(47, 129, 247, 0); } }



        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 200; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }

        .modal-overlay.open { display: flex; animation: fadeIn 0.3s; }

        .modal { background: #161b22; width: 95%; max-width: 600px; border-radius: 16px; border: 1px solid var(--border-color); box-shadow: 0 20px 50px rgba(0,0,0,0.6); overflow: hidden; display: flex; flex-direction: column; }

        .modal-header { padding: 20px 30px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; background: #0d1117; }

        .modal-body { padding: 30px; max-height: 70vh; overflow-y: auto; }

        .modal-footer { padding: 20px 30px; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; gap: 10px; background: #0d1117; }

        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }

        .info-item label { display: block; color: var(--text-muted); font-size: 0.8rem; margin-bottom: 5px; text-transform: uppercase; }

        .info-item p { color: #FFF; font-weight: 500; font-family: 'JetBrains Mono', monospace; }

        .os-badge { background: #333; color: #fff; padding: 4px 8px; border-radius: 4px; font-family: 'JetBrains Mono'; font-size: 0.8rem; border: 1px solid #555; }



        /* Estilos Extras para o Modal de Credenciais */

        .credential-box {

            background: rgba(0,0,0,0.2);

            border: 1px solid var(--border-color);

            border-radius: 8px;

            padding: 15px;

            margin-bottom: 15px;

        }

        .credential-row {

            display: flex;

            justify-content: space-between;

            align-items: center;

            margin-bottom: 10px;

            padding-bottom: 10px;

            border-bottom: 1px solid rgba(255,255,255,0.05);

        }

        .credential-row:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }

        .credential-label { color: var(--text-muted); font-size: 0.85rem; font-weight: 500; }

        .credential-value { color: var(--primary); font-family: 'JetBrains Mono', monospace; font-size: 1rem; user-select: text; }

        .copy-btn { background: transparent; border: none; color: var(--text-muted); cursor: pointer; transition: 0.2s; }

        .copy-btn:hover { color: #fff; }



        .notif-list { display: flex; flex-direction: column; gap: 10px; }

        .notif-item { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 8px; border: 1px solid transparent; cursor: pointer; transition: 0.2s; display: flex; justify-content: space-between; align-items: center; }

        .notif-item:hover { border-color: var(--primary); background: rgba(47, 129, 247, 0.05); }

        .notif-info h4 { font-size: 1rem; color: #fff; }

        .notif-info span { font-size: 0.8rem; color: var(--text-muted); }



        .btn { padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; transition: 0.2s; }

        .btn-primary { background: var(--primary); color: white; }

        .btn-primary:hover { background: #005CC5; }

        .btn-success { background: var(--success); color: white; }

        .btn-success:hover { background: #1a6329; }

        .btn-danger { background: rgba(248, 81, 73, 0.1); color: #f85149; border: 1px solid rgba(248, 81, 73, 0.3); }

        .btn-danger:hover { background: #f85149; color: white; }

        .btn-secondary { background: transparent; border: 1px solid var(--border-color); color: var(--text-main); }

        .btn-secondary:hover { background: rgba(255,255,255,0.05); }

        .actions { display: flex; gap: 8px; justify-content: flex-end; align-items: center; z-index: 10; position: relative;}

        .btn-icon { width: 34px; height: 34px; border-radius: 8px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; background: transparent; }

        .btn-icon:hover { background: rgba(255,255,255,0.1); }



        .toast-container { position: fixed; bottom: 30px; right: 30px; z-index: 300; display: flex; flex-direction: column; gap: 10px; }

        .toast { background: #1F242C; color: white; padding: 15px 20px; border-radius: 8px; border-left: 4px solid var(--primary); box-shadow: 0 10px 30px rgba(0,0,0,0.5); animation: slideIn 0.3s ease-out; }

        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }



        @media (max-width: 900px) {

            aside { transform: translateX(-100%); box-shadow: 5px 0 20px rgba(0,0,0,0.5); }

            aside.open { transform: translateX(0); }

            main { margin-left: 0; padding: 80px 20px 40px 20px; }

            .mobile-toggle { display: block; }

            .header-text-container { margin-left: 40px; }

            .info-grid { grid-template-columns: 1fr; }

        }

        @media (max-width: 600px) {

            .header-actions { width: 100%; justify-content: space-between; margin-top: 20px; }

            .user-badge { margin-left: auto; }

            .access-card { flex-direction: column; align-items: flex-start; gap: 15px; }

            .access-card > div { width: 100%; text-align: left !important; }

            .log-row { grid-template-columns: 1fr; gap: 5px; padding: 15px; }

        }

    </style>

</head>

<body>



    <button class="mobile-toggle" onclick="toggleSidebar()">

        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>

    </button>

    

    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>



    <aside id="mainSidebar">

        <div class="brand" onclick="window.location.reload()">

            <svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="50 50 400 400">

                <g transform="translate(0.000000,500.000000) scale(0.100000,-0.100000)">

                    <path d="M1507 3963 c-4 -3 -7 -261 -7 -573 l0 -566 173 -152 c94 -83 195 -172 222 -196 l50 -45 126 -1 127 0 58 68 c32 37 78 87 101 112 23 25 54 61 68 80 14 18 31 37 37 42 7 4 -86 8 -207 8 l-220 0 -75 70 c-41 39 -90 82 -107 96 l-33 26 0 369 0 369 335 2 335 3 -33 35 c-18 19 -52 60 -76 90 -25 30 -49 60 -55 65 -6 6 -28 31 -49 58 l-38 47 -363 0 c-199 0 -366 -3 -369 -7z"></path>

                    <path d="M2416 3903 c32 -38 61 -70 64 -73 6 -5 262 -300 304 -350 40 -49 141 -165 146 -170 3 -3 22 -25 42 -50 l37 -46 -92 -105 c-95 -110 -446 -520 -530 -621 l-49 -58 200 0 199 0 99 117 c54 65 122 142 149 173 130 146 410 480 410 489 0 10 -29 45 -179 220 -54 64 -110 130 -124 146 -14 17 -53 62 -86 100 -34 39 -74 86 -90 105 -16 19 -60 70 -98 113 l-70 77 -195 0 -195 0 58 -67z"></path>

                    <path d="M3300 3564 c0 -3 44 -60 98 -125 53 -66 117 -144 141 -174 l43 -54 -146 -170 c-80 -94 -146 -173 -146 -176 0 -3 33 -5 74 -5 l74 0 154 168 c84 92 157 170 162 173 4 4 7 11 5 17 -2 5 -74 87 -159 181 l-155 171 -72 0 c-40 0 -73 -3 -73 -6z"></path>

                </g>

            </svg>

            <span class="brand-text">INTEGRUX</span>

        </div>

        <nav class="nav-menu">

            <div class="nav-item active" onclick="switchView('dashboard', this)">

                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>

                Dashboard

            </div>

            <div class="nav-item" onclick="switchView('os-executor', this)">

                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>

                Executador de OS

                <span id="osBadge" class="sidebar-badge hidden">0</span>

            </div>

            <div class="nav-item" onclick="switchView('access', this)">

                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>

                Gestão de Acessos

            </div>

            <div class="nav-item" onclick="switchView('logs', this)">

                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>

                Logs de Auditoria

            </div>

        </nav>

        <div onclick="logout()" class="btn-logout">

            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>

            Sair do Sistema

        </div>

    </aside>



    <main>

        <header>

            <div id="header-text" class="header-text-container">

                <h1>Visão Geral</h1>

                <p class="subtitle">Monitoramento em tempo real do ecossistema.</p>

            </div>

            <div class="header-actions">

                <div class="notification-wrapper" onclick="openNotificationModal()">

                    <div class="btn-bell">

                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>

                    </div>

                    <div class="badge-count hidden" id="notifCount">0</div>

                </div>



                <div class="user-badge" id="currentUserBadge">

                    <div style="text-align: right;">

                        <div style="font-size: 0.9rem; font-weight: 700;" id="currentUserName">...</div>

                        <div style="font-size: 0.75rem; color: var(--primary);" id="currentUserRole">...</div>

                    </div>

                    <div class="avatar" id="currentUserInitial">?</div>

                </div>

            </div>

        </header>



        <section id="view-dashboard" class="view-section active-view">

            <div class="stats-grid">

                <div class="card">

                    <div class="card-header">

                        <div>

                            <div class="card-label">Empresas Ativas</div>

                            <div class="card-val" id="totalCount">0</div>

                        </div>

                        <div class="card-icon-bg">

                            <svg width="24" height="24" stroke="var(--primary)" fill="none" stroke-width="2" viewBox="0 0 24 24"><path d="M3 21h18"/><path d="M5 21V7l8-4 8 4v14"/><path d="M17 21v-8.87a4 4 0 0 0-3.36-3.98l-3.19-.52"/></svg>

                        </div>

                    </div>

                    <div style="color: var(--success); font-size: 0.8rem; display: flex; align-items: center; gap: 5px;">

                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>

                        Ecossistema em expansão

                    </div>

                </div>



                <div class="card">

                    <div class="card-header">

                        <div>

                            <div class="card-label">Em Manutenção</div>

                            <div class="card-val" id="maintCount" style="color: var(--warning);">0</div>

                        </div>

                        <div class="card-icon-bg">

                            <svg width="24" height="24" stroke="var(--warning)" fill="none" stroke-width="2" viewBox="0 0 24 24"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>

                        </div>

                    </div>

                    <div style="color: var(--text-muted); font-size: 0.8rem;">Revisão técnica programada</div>

                </div>



                <div class="card" style="border-color: rgba(47, 129, 247, 0.3);">

                    <div class="card-header" style="margin-bottom: 5px;">

                        <div>

                            <div class="card-label">Ordens de Serviço</div>

                            <div class="card-val" id="osTotal">42</div>

                        </div>

                        <div class="card-icon-bg">

                            <svg width="24" height="24" stroke="#E6EDF3" fill="none" stroke-width="2" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>

                        </div>

                    </div>

                    <div class="os-list">

                        <div class="os-item"><span>Implantação</span> <span>12</span></div>

                        <div class="os-item"><span>Suporte N1</span> <span>28</span></div>

                        <div class="os-item"><span>Bug Fix</span> <span>02</span></div>

                    </div>

                </div>

            </div>



            <div class="table-container">

                <div class="table-header">

                    <h3>Empresas Gerenciadas <span class="chip" id="activeChip">0 Ativas</span></h3>

                    <button class="btn btn-secondary" style="font-size: 0.8rem;" onclick="renderTable()">

                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 5px;"><path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.3"/></svg>

                        Atualizar

                    </button>

                </div>

                <table>

                    <thead>

                        <tr>

                            <th>Empresa</th>

                            <th>CNPJ</th>

                            <th>OS Vinculada</th>

                            <th>Status</th>

                            <th style="text-align: right;">Controles</th>

                        </tr>

                    </thead>

                    <tbody id="companyTable"></tbody>

                </table>

            </div>

        </section>



        <section id="view-os-executor" class="view-section">

            <div class="card" style="margin-bottom: 20px;">

                <h3 style="margin-bottom: 10px;">Execução de Ordens de Serviço</h3>

                <p style="color: var(--text-muted); font-size: 0.9rem;">Gerencie o ciclo de vida das manutenções e implantações.</p>

                <div style="display: flex; gap: 15px; margin-top: 15px; flex-wrap: wrap;">

                    <span class="status-pill os-status-pending">Pendente: Aguardando Técnico</span>

                    <span class="status-pill os-status-exec">Em Execução: Timer Ativo</span>

                    <span class="status-pill os-status-done">Concluído: Sistema Online</span>

                </div>

            </div>



            <div class="table-container">

                 <div class="table-header">

                    <h3>Fila de Execução</h3>

                    <button class="btn btn-secondary" style="font-size: 0.8rem;" onclick="renderOSTable()">

                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 5px;"><path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.3"/></svg>

                        Atualizar Fila

                    </button>

                </div>

                <table>

                    <thead>

                        <tr>

                            <th>OS ID</th>

                            <th>Empresa</th>

                            <th>Tipo Serviço</th>

                            <th>Status Atual</th>

                            <th style="text-align: right;">Ações de Execução</th>

                        </tr>

                    </thead>

                    <tbody id="osTableBody">

                        </tbody>

                </table>

            </div>

        </section>



        <section id="view-access" class="view-section">

            <div class="card" style="margin-bottom: 20px;">

                <h3 style="margin-bottom: 10px;">Controle de Permissões</h3>

                <p style="color: var(--text-muted); font-size: 0.9rem;">Gerencie quem tem acesso ao painel de controle mestre da Integrux.</p>

            </div>

            

            <div id="usersListContainer">

                </div>

        </section>



        <section id="view-logs" class="view-section">

            <div class="card" style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">

                <div>

                    <h3 style="margin-bottom: 5px;">Logs do Sistema</h3>

                    <p style="color: var(--text-muted); font-size: 0.9rem;">Registro imutável de ações realizadas.</p>

                </div>

                <button class="btn btn-secondary" onclick="Logger.clear()" style="border-color: var(--border-color); color: var(--danger);">

                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:5px;"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>

                    Limpar Logs

                </button>

            </div>

            <div class="log-terminal" id="logsTerminal">

                </div>

        </section>



    </main>



    <div class="modal-overlay" id="notifModal">

        <div class="modal">

            <div class="modal-header">

                <h3>Solicitações Pendentes (Cadastro)</h3>

                <button class="btn-icon" onclick="closeModal('notifModal')"><svg width="20" height="20" stroke="currentColor" viewBox="0 0 24 24" fill="none"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>

            </div>

            <div class="modal-body">

                <div id="pendingList" class="notif-list"></div>

            </div>

        </div>

    </div>



    <div class="modal-overlay" id="detailsModal">

        <div class="modal">

            <div class="modal-header">

                <h3 id="modalTitle">Detalhes da Empresa</h3>

                <button class="btn-icon" onclick="closeModal('detailsModal')" style="margin-left:auto;"><svg width="20" height="20" stroke="currentColor" viewBox="0 0 24 24" fill="none"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>

            </div>

            <div style="padding: 10px 30px 0 30px;"><span class="os-badge" id="modalOS">OS-####</span></div>

            <div class="modal-body">

                <div class="info-grid">

                    <div class="info-item"><label>Razão Social</label><p id="detName">--</p></div>

                    <div class="info-item"><label>CNPJ</label><p id="detCNPJ">--</p></div>

                    <div class="info-item"><label>Email de Contato</label><p id="detEmail" style="font-size: 0.9rem;">--</p></div>

                    <div class="info-item"><label>Telefone</label><p id="detPhone">--</p></div>

                    <div class="info-item" style="grid-column: span 2;"><label>Segmento / Observações</label><p id="detSegment" style="color: var(--text-muted); font-size: 0.9rem;">--</p></div>

                </div>

            </div>

            <div class="modal-footer" id="modalActions"></div>

        </div>

    </div>

    

    <div class="modal-overlay" id="credentialsModal">

        <div class="modal">

            <div class="modal-header">

                <h3>Credenciais Geradas</h3>

                <button class="btn-icon" onclick="closeModal('credentialsModal')"><svg width="20" height="20" stroke="currentColor" viewBox="0 0 24 24" fill="none"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>

            </div>

            <div class="modal-body">

                <p style="color: var(--text-muted); margin-bottom: 20px; font-size: 0.9rem;">Acesso liberado. Envie os dados abaixo para o cliente. <br><span style="color: var(--success); font-weight: 600;">O usuário poderá alterar esta senha no primeiro acesso.</span></p>

                

                <div class="credential-box">

                    <div class="credential-row">

                        <span class="credential-label">Usuário</span>

                        <div style="display:flex; align-items:center; gap:10px;">

                            <span class="credential-value" id="credUser">--</span>

                            <button class="copy-btn" onclick="copyToClipboard('credUser')" title="Copiar"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button>

                        </div>

                    </div>

                    <div class="credential-row">

                        <span class="credential-label">Senha Provisória</span>

                        <div style="display:flex; align-items:center; gap:10px;">

                            <span class="credential-value" id="credPass">--</span>

                            <button class="copy-btn" onclick="copyToClipboard('credPass')" title="Copiar"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button>

                        </div>

                    </div>

                    <div class="credential-row">

                        <span class="credential-label">Arquivo de Acesso</span>

                        <div style="display:flex; align-items:center; gap:10px;">

                            <span class="credential-value" id="credUrl">--</span>

                            <button class="copy-btn" onclick="copyToClipboard('credUrl')" title="Copiar"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></button>

                        </div>

                    </div>

                </div>

            </div>

            <div class="modal-footer">

                <button class="btn btn-secondary" onclick="closeModal('credentialsModal')">Fechar</button>

            </div>

        </div>

    </div>



    <div class="toast-container" id="toastArea"></div>



    <script>

        // --- 1. SESSÃO E RESPONSIVIDADE ---

        function checkSession() {

            const sessionData = localStorage.getItem('integrux_session');

            if(!sessionData) { window.location.href = 'index.html'; return null; }

            return JSON.parse(sessionData);

        }



        const currentUser = checkSession();



        function logout() {

            localStorage.removeItem('integrux_session');

            window.location.href = 'index.html';

        }



        function toggleSidebar() {

            document.getElementById('mainSidebar').classList.toggle('open');

            const overlay = document.getElementById('sidebarOverlay');

            overlay.style.display = overlay.style.display === 'block' ? 'none' : 'block';

        }



        function updateUserUI() {

            if(!currentUser) return;

            document.getElementById('currentUserName').innerText = currentUser.name;

            document.getElementById('currentUserRole').innerText = currentUser.role;

            const avatar = document.getElementById('currentUserInitial');

            avatar.innerText = currentUser.initial;

            avatar.style.background = currentUser.color;

        }



        const SYSTEM_USERS_VIEW = [

            { name: "Algarte", role: "Desenvolvedor", email: "algarte@integrux.com", passHash: "MzE1MTdJTlRFR1JVWF9TQUxU=", initial: "A", color: "#2F81F7" },

            { name: "Daniel", role: "CEO", email: "daniel@integrux.com", passHash: "MzMxMTFJTlRFR1JVWF9TQUxU=", initial: "D", color: "#D29922" },

            { name: "MasterAdmin", role: "Super Admin", email: "admin@integrux.com", passHash: "NTIwMnh1cmdldG5pSU5URUdSVVhfU0FMVA==", initial: "M", color: "#238636" },

            { name: "Almoxarifado", role: "Almoxarifado", email: "almoxarifado@integrux.com", passHash: "NDMyMTFJTlRFR1JVWF9TQUxU=", initial: "AL", color: "#6e7681" }

        ];



        // --- 2. LOGS ---

        const Logger = {

            getLogs: () => JSON.parse(localStorage.getItem('integrux_logs')) || [],

            log: (action, desc) => {

                const logs = Logger.getLogs();

                const now = new Date();

                const timeString = `${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;

                logs.unshift({ user: currentUser.name, time: timeString, action: action, desc: desc });

                if(logs.length > 50) logs.pop(); 

                localStorage.setItem('integrux_logs', JSON.stringify(logs));

                renderLogs();

            },

            clear: () => {

                if(confirm('Deseja limpar todos os logs de auditoria?')) {

                    localStorage.removeItem('integrux_logs');

                    renderLogs();

                    showToast('Logs limpos com sucesso.', 'success');

                }

            }

        };



        function renderLogs() {

            const logs = Logger.getLogs();

            const terminal = document.getElementById('logsTerminal');

            if(logs.length === 0) { terminal.innerHTML = '<div style="padding:20px; color:#555; text-align:center;">Nenhum registro de atividade.</div>'; return; }

            let html = '';

            logs.forEach(l => {

                html += `<div class="log-row"><div class="log-time">${l.time}</div><div class="log-user">${l.user}</div><div class="log-action">[${l.action}] <span>${l.desc}</span></div></div>`;

            });

            terminal.innerHTML = html;

        }



        // --- 3. UTILITÁRIOS ---

        function showToast(msg, type = 'info') {

            const area = document.getElementById('toastArea');

            const toast = document.createElement('div');

            toast.className = 'toast';

            toast.style.borderLeftColor = type === 'success' ? '#238636' : (type === 'warn' ? '#d29922' : '#f85149');

            toast.innerHTML = `<span>${msg}</span>`;

            area.appendChild(toast);

            setTimeout(() => toast.remove(), 3000);

        }

        

        function copyToClipboard(elementId) {

            const text = document.getElementById(elementId).innerText;

            navigator.clipboard.writeText(text).then(() => {

                showToast('Copiado para a área de transferência!', 'success');

            }, (err) => {

                showToast('Erro ao copiar.', 'error');

            });

        }



        function generateOS() { return `OS-${new Date().getFullYear()}-${Math.floor(1000 + Math.random() * 9000)}`; }



        function switchView(viewName, element) {

            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active-view'));

            if(element) {

                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));

                element.classList.add('active');

            }

            document.getElementById(`view-${viewName}`).classList.add('active-view');

            

            if(window.innerWidth <= 900) {

                 document.getElementById('mainSidebar').classList.remove('open');

                 document.getElementById('sidebarOverlay').style.display = 'none';

            }



            const headerText = document.getElementById('header-text');

            if(viewName === 'access') {

                headerText.innerHTML = '<h1>Gestão de Acessos</h1><p class="subtitle">Controle de permissões e hierarquia.</p>';

                renderAccessList();

            } else if (viewName === 'logs') {

                headerText.innerHTML = '<h1>Logs de Auditoria</h1><p class="subtitle">Rastreabilidade completa do sistema.</p>';

                renderLogs();

            } else if (viewName === 'os-executor') {

                headerText.innerHTML = '<h1>Executador de OS</h1><p class="subtitle">Gerenciamento técnico de serviços.</p>';

                renderOSTable();

            } else {

                headerText.innerHTML = '<h1>Visão Geral</h1><p class="subtitle">Monitoramento em tempo real do ecossistema.</p>';

                renderTable(); 

            }

        }



        function closeModal(id) { document.getElementById(id).classList.remove('open'); }

        function openNotificationModal() { renderNotifications(); document.getElementById('notifModal').classList.add('open'); }



        // --- 4. CORE LOGIC ---



        function getCompanies() {

            const raw = localStorage.getItem('integrux_leads');

            let list = raw ? JSON.parse(raw) : [];

            let updated = false;

            list = list.map(c => {

                if(!c.osNumber) { c.osNumber = generateOS(); updated = true; }

                if(!c.osStatus) { c.osStatus = 'none'; updated = true; } 

                return c;

            });

            if(updated) localStorage.setItem('integrux_leads', JSON.stringify(list));

            return list;

        }



        // --- FLUXO DE APROVAÇÃO E EXECUÇÃO ---

        

        // 1. APROVAÇÃO (Sai do Sino -> Vai para OS Pending)

        function approveLead(id) {

            let list = getCompanies();

            let item = list.find(x => x.id === id);

            if(item) {

                // Muda status para 'pending' (significa que saiu do cadastro, mas não está ativo ainda)

                item.status = 'pending'; 

                // Define status da OS para pendente

                item.osStatus = 'pending'; 

                item.siteEnabled = false; 



                localStorage.setItem('integrux_leads', JSON.stringify(list));

                Logger.log('APROVAÇÃO', `Lead aprovado: ${item.name}. Aguardando Execução da OS.`);

                

                showToast(`OS ${item.osNumber} criada! Vá para "Executador de OS".`, 'success');

                

                renderTable(); // Atualiza contadores

                renderNotifications(); // Remove da lista do sino se estiver aberta

                closeModal('notifModal');

            }

        }



        // 2. Tabela de OS

        function renderOSTable() {

            const companies = getCompanies();

            // Filtra: Pending (aprovado), Maintenance (manutenção), ou Em Progresso

            const osList = companies.filter(c => c.osStatus === 'pending' || c.osStatus === 'in_progress');

            

            const tbody = document.getElementById('osTableBody');

            tbody.innerHTML = '';



            if (osList.length === 0) {

                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding: 40px; color: #555;">Nenhuma Ordem de Serviço pendente.</td></tr>';

                return;

            }



            osList.forEach(c => {

                let badge = '';

                let actions = '';

                let serviceType = c.status === 'maintenance' ? 'Manutenção' : 'Implantação Inicial';



                if (c.osStatus === 'pending') {

                    badge = '<span class="os-status-pill os-status-pending">Pendente</span>';

                    // Botão para INICIAR

                    actions = `<button class="btn btn-primary" style="padding: 6px 12px; font-size: 0.8rem;" onclick="startOS(${c.id})">Iniciar Execução</button>`;

                } else if (c.osStatus === 'in_progress') {

                    badge = '<span class="os-status-pill os-status-exec">Em Execução</span>';

                    // Botão para FINALIZAR

                    actions = `

                        <div class="os-action-bar">

                             <div class="timer-badge">

                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>

                                Executando...

                            </div>

                            <button class="btn btn-success" style="padding: 6px 12px; font-size: 0.8rem;" onclick="finishOS(${c.id})">Finalizar & Entregar</button>

                        </div>

                    `;

                }



                const html = `

                <tr class="data-row">

                    <td class="mono-font" style="color: #FFF;">${c.osNumber}</td>

                    <td>${c.name || c.companyName}</td>

                    <td>${serviceType}</td>

                    <td>${badge}</td>

                    <td>${actions}</td>

                </tr>`;

                tbody.innerHTML += html;

            });

        }



        // 3. Iniciar Execução

        function startOS(id) {

            let list = getCompanies();

            let item = list.find(x => x.id === id);

            if(item) {

                item.osStatus = 'in_progress';

                localStorage.setItem('integrux_leads', JSON.stringify(list));

                Logger.log('OS INICIADA', `Técnico iniciou execução da ${item.osNumber} (${item.name})`);

                showToast('Execução iniciada.', 'info');

                renderOSTable();

                updateNotificationBadge();

            }

        }



        // 4. Finalizar e GERAR USUÁRIO (MODIFICADO)

        function finishOS(id) {

            let list = getCompanies();

            let item = list.find(x => x.id === id);

            if(item) {

                if(confirm(`Deseja finalizar a OS ${item.osNumber} e liberar o sistema para o cliente?`)) {

                    

                    // --- GERAÇÃO DE CREDENCIAIS PERSONALIZADA ---

                    // Pega a primeira palavra do nome da empresa

                    const firstWord = item.name.trim().split(' ')[0];

                    

                    // Usuário é apenas a primeira palavra

                    const generatedUser = firstWord;

                    

                    // Senha aleatória

                    const generatedPass = Math.random().toString(36).slice(-8); 



                    // Arquivo segue padrão empresa + nome + .html (tudo minúsculo)

                    const generatedFile = `empresa${firstWord.toLowerCase()}.html`;



                    // Atualiza Objeto

                    item.osStatus = 'completed';

                    item.status = 'active'; // Ativa a empresa no Dashboard Principal

                    item.siteEnabled = true; // Site ON

                    item.generatedUser = generatedUser;

                    item.generatedPass = generatedPass;

                    item.redirectUrl = generatedFile;

                    item.mustChangePassword = true; // Flag para indicar troca de senha



                    localStorage.setItem('integrux_leads', JSON.stringify(list));

                    

                    Logger.log('OS FINALIZADA', `Serviço concluído. Credenciais geradas para ${item.name}.`);

                    

                    renderOSTable();

                    updateNotificationBadge();

                    switchView('dashboard'); 



                    // --- ABRE O NOVO MODAL DE CREDENCIAIS ---

                    showCredentialsModal(generatedUser, generatedPass, generatedFile);

                }

            }

        }



        function showCredentialsModal(user, pass, url) {

            document.getElementById('credUser').innerText = user;

            document.getElementById('credPass').innerText = pass;

            document.getElementById('credUrl').innerText = url;

            document.getElementById('credentialsModal').classList.add('open');

        }



        // --- FUNÇÕES DE DASHBOARD ---

        function renderAccessList() {

            const container = document.getElementById('usersListContainer');

            let html = '';

            SYSTEM_USERS_VIEW.forEach(user => {

                const maskedHash = user.passHash.substring(0, 10) + '...';

                html += `

                <div class="access-card">

                    <div class="access-user">

                        <div class="avatar" style="background: ${user.color};">${user.initial}</div>

                        <div>

                            <div style="font-weight: 700; color: #FFF;">${user.name} <span class="role-badge">${user.role}</span></div>

                            <div style="font-size: 0.8rem; color: var(--text-muted);">${user.email}</div>

                        </div>

                    </div>

                    <div style="text-align:right;">

                        <div style="font-size:0.7rem; color:#555; text-transform:uppercase;">Senha (Hash)</div>

                        <div class="pwd-hash">${maskedHash}</div>

                    </div>

                </div>`;

            });

            container.innerHTML = html;

        }



        function renderNotifications() {

            const companies = getCompanies();

            // Apenas lead_qualificado aparece no sino. Pending vai pra OS.

            const pending = companies.filter(c => c.status === 'lead_qualificado');

            const listEl = document.getElementById('pendingList');

            listEl.innerHTML = '';

            if(pending.length === 0) {

                listEl.innerHTML = '<div style="text-align:center; color:#555; padding:20px;">Tudo limpo! Nenhuma solicitação pendente.</div>';

                return;

            }

            pending.forEach(c => {

                const item = document.createElement('div');

                item.className = 'notif-item';

                item.innerHTML = `

                    <div class="notif-info">

                        <h4>${c.name || c.companyName}</h4>

                        <span>${c.cnpj} • ${c.osNumber}</span>

                    </div>

                    <div style="font-size:0.8rem; color: var(--primary);">Ver Detalhes -></div>

                `;

                item.onclick = () => { closeModal('notifModal'); openCompanyDetails(c.id, true); };

                listEl.appendChild(item);

            });

        }



        function updateNotificationBadge() {

            const companies = getCompanies();

            

            // Badge do Sino (Apenas Cadastros Novos)

            const newLeadsCount = companies.filter(c => c.status === 'lead_qualificado').length;

            const notifBadge = document.getElementById('notifCount');

            notifBadge.innerText = newLeadsCount;

            if(newLeadsCount > 0) notifBadge.classList.remove('hidden'); else notifBadge.classList.add('hidden');



            // Badge da OS (OS Pendente ou Em Execução)

            const osPendingCount = companies.filter(c => c.osStatus === 'pending' || c.osStatus === 'in_progress').length;

            const osBadge = document.getElementById('osBadge');

            osBadge.innerText = osPendingCount;

            if(osPendingCount > 0) osBadge.classList.remove('hidden'); else osBadge.classList.add('hidden');

        }



        function openCompanyDetails(id, isPending) {

            const list = getCompanies();

            const c = list.find(x => x.id === id);

            if(!c) return;



            document.getElementById('modalTitle').innerText = c.name || c.companyName;

            document.getElementById('modalOS').innerText = c.osNumber;

            document.getElementById('detName').innerText = c.name || c.companyName;

            document.getElementById('detCNPJ').innerText = c.cnpj;

            document.getElementById('detEmail').innerText = c.email || 'Não informado';

            document.getElementById('detPhone').innerText = c.phone || 'Não informado';

            document.getElementById('detSegment').innerText = c.segment || 'Cadastro realizado via WebSite.';



            const footer = document.getElementById('modalActions');

            footer.innerHTML = '';

            

            // Se for Cadastro Novo (isPending=true), mostra Aprovar/Recusar

            // Se for Empresa Ativa, mostra Editar/Remover

            

            const removeBtn = `<button class="btn btn-danger" onclick="removeCompany(${c.id}); closeModal('detailsModal')">${isPending ? 'Recusar Cadastro' : 'Remover Empresa'}</button>`;



            if(isPending) {

                footer.innerHTML = `

                    ${removeBtn}

                    <button class="btn btn-primary" onclick="approveLead(${c.id}); closeModal('detailsModal')">Aprovar & Gerar OS</button>

                `;

            } else {

                footer.innerHTML = `

                    ${removeBtn}

                    <button class="btn btn-primary" onclick="window.location.href='editar-empresa.html?id=${c.id}'">Editar Dados</button>

                `;

            }

            document.getElementById('detailsModal').classList.add('open');

        }



        function renderTable() {

            const companies = getCompanies();

            // Mostra apenas ativas ou em manutenção no Dashboard Principal

            const activeCompanies = companies.filter(c => c.status === 'active' || c.status === 'maintenance');

            const tbody = document.getElementById('companyTable');

            

            document.getElementById('totalCount').innerText = activeCompanies.length;

            document.getElementById('maintCount').innerText = companies.filter(c => c.status === 'maintenance').length;

            document.getElementById('activeChip').innerText = `${activeCompanies.length} Ativas`;

            document.getElementById('osTotal').innerText = companies.length;



            tbody.innerHTML = '';

            if (activeCompanies.length === 0) {

                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding: 40px; color: #555;">Nenhuma empresa ativa no momento.</td></tr>';

                updateNotificationBadge();

                return;

            }



            activeCompanies.forEach(company => {

                const isMaint = company.status === 'maintenance';

                const isSiteOn = company.siteEnabled;

                const badgeClass = isMaint ? 'maintenance' : (isSiteOn ? 'active' : 'offline');

                const badgeText = isMaint ? 'Manutenção' : (isSiteOn ? 'Online' : 'Offline');



                const html = `

                <tr class="data-row">

                    <td onclick="openCompanyDetails(${company.id}, false)">${company.name || company.companyName}</td>

                    <td class="mono-font">${company.cnpj}</td>

                    <td><span class="os-badge">${company.osNumber}</span></td>

                    <td><span class="status-pill ${badgeClass}">${badgeText}</span></td>

                    <td>

                        <div class="actions">

                            <button class="btn-icon" style="color:var(--primary)" onclick="window.location.href='editar-empresa.html?id=${company.id}'" title="Editar"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></button>

                            <button class="btn-icon" style="color:${isMaint ? '#d29922' : '#7D8590'}" onclick="toggleMaint(${company.id})" title="Manutenção"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg></button>

                            <button class="btn-icon" style="color:${isSiteOn ? '#238636' : '#f85149'}" onclick="toggleSite(${company.id})" title="Ligar/Desligar Site"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path><line x1="12" y1="2" x2="12" y2="12"></line></svg></button>

                        </div>

                    </td>

                </tr>`;

                tbody.innerHTML += html;

            });

            updateNotificationBadge();

        }



        function removeCompany(id) {

            let list = getCompanies();

            let item = list.find(x => x.id === id);

            if(confirm('Tem certeza que deseja remover este registro permanentemente?')) {

                const name = item ? (item.name || item.companyName) : 'Desconhecida';

                list = list.filter(x => x.id !== id);

                localStorage.setItem('integrux_leads', JSON.stringify(list));

                Logger.log('EXCLUSÃO', `Removeu o registro da empresa ${name}`);

                showToast('Registro removido do sistema.', 'warn');

                renderTable();

                updateNotificationBadge();

                closeModal('notifModal');

            }

        }



        function toggleMaint(id) {

            let list = getCompanies();

            let item = list.find(x => x.id === id);

            if(item) {

                if(item.status === 'maintenance') {

                    item.status = 'active';

                    item.osStatus = 'completed';

                    Logger.log('MANUTENÇÃO', `Finalizou manutenção da empresa ${item.name}`);

                    showToast('Manutenção finalizada.', 'success');

                } else {

                    item.status = 'maintenance';

                    item.osStatus = 'pending'; // Vai para a aba de OS para técnico resolver

                    Logger.log('MANUTENÇÃO', `Solicitou manutenção na empresa ${item.name}`);

                    showToast('Solicitação enviada para o Executador de OS!', 'warn');

                }

                localStorage.setItem('integrux_leads', JSON.stringify(list));

                renderTable();

                updateNotificationBadge();

            }

        }



        function toggleSite(id) {

            let list = getCompanies();

            let item = list.find(x => x.id === id);

            if(item) {

                item.siteEnabled = !item.siteEnabled;

                const status = item.siteEnabled ? 'Online' : 'Offline';

                Logger.log('STATUS SITE', `Alterou status do site ${item.name} para ${status}`);

                if(item.siteEnabled) showToast('Site online.', 'success');

                else showToast('Site offline.', 'warn');

                localStorage.setItem('integrux_leads', JSON.stringify(list));

                renderTable();

            }

        }



        window.onload = function() {

            updateUserUI(); 

            renderTable();

            updateNotificationBadge();

        };

    </script>

</body>

</html>
